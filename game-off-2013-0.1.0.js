/**
 * game-off-2013 - v0.1.0 - 2013-11-05
 * 
 *
 * Copyright (c) 2013 Froggies Team
 * Licensed  <>
 */
var Constants={FPS:3e3,NB_COLUMNS:5,NB_ROWS:5},BacklogController=function(){"use strict";function a(){this.view=new BacklogView(this),this.cards=[]}return a.prototype.addCard=function(){var a=new CardController;return this.cards.push(a),a.start(this.view.container),a},a.prototype.removeCard=function(a){var b=this.cards.indexOf(a);b>-1&&this.cards.splice(b,1)},a.prototype.start=function(a){this.view.draw(a)},a}(),CardController=function(){"use strict";function a(){this.view=new CardView(this)}return a.prototype.start=function(a){this.view.draw(a)},a}(),ColumnController=function(){"use strict";function a(a){this.game=a,this.view=new ColumnView(this),this.isActive=!1,this.header=new HeaderColumnController,this.rows=[];for(var b=0;b<Constants.NB_ROWS;b++)this.rows.push(new RowController)}return a.prototype.start=function(a){this.view.draw(a),this.header.start(this.view.container);for(var b=0;b<this.rows.length;b++)this.rows[b].start(this.view.container)},a.prototype.activate=function(){this.isActive=!0,this.view.activate()},a.prototype.activeNextRow=function(){for(var a=0;a<this.rows.length;a++)if(this.rows[a].isActive===!1)return this.rows[a].activate(),void 0},a.prototype.addCard=function(a){for(var b=0;b<this.rows.length;b++)if(this.rows[b].canAcceptCard()===!0)return this.rows[b].addCard(a),this.game.deleteCardInBacklog(a),!0;return!1},a}(),GameController=function(){"use strict";function a(){this.nbLoop=0,this.timeout=void 0,this.view=new GameView(this),this.backlog=new BacklogController,this.columns=[];for(var a=0;a<Constants.NB_COLUMNS;a++)this.columns.push(new ColumnController(this))}return a.prototype.start=function(a){this.view.draw(a);for(var b=0;b<this.columns.length;b++)this.columns[b].start(this.view.container);this.backlog.start(this.view.container),this.resume()},a.prototype.pause=function(){window.clearInterval(this.timeout),this.timeout=void 0},a.prototype.resume=function(){if(void 0===this.timeout){var a=this;this.timeout=window.setInterval(function(){a.loop()},Constants.FPS)}},a.prototype.deleteCardInBacklog=function(a){this.backlog.removeCard(a)},a.prototype.loop=function(){return this.nbLoop=this.nbLoop+1,this.backlog.addCard(),this.backlog.cards.length>10?(this.pause(),window.alert("Game over"),"finish"):void 0},a}(),HeaderColumnController=function(){"use strict";function a(){this.view=new HeaderColumnView(this)}return a.prototype.start=function(a){this.view.draw(a)},a}(),RowController=function(){"use strict";function a(){this.view=new RowView(this),this.isActive=!1,this.card=void 0}return a.prototype.start=function(a){this.view.draw(a)},a.prototype.activate=function(){this.isActive=!0,this.view.activate()},a.prototype.canAcceptCard=function(){return this.isActive&&void 0===this.card},a.prototype.addCard=function(a){this.card=a,a.start(this.view.container)},a}();window.onload=function(){function a(a,b){a.onclick=function(){d.columns[b].activate()}}function b(a,b){a.onclick=function(){d.columns[b].activeNextRow()}}var c,d=new GameController,e=document.createElement("div");c=document.createElement("button"),c.innerHTML="Add card",c.onclick=function(){d.backlog.addCard()},e.appendChild(c),c=document.createElement("button"),c.innerHTML="Log backlog",c.onclick=function(){console.log(d.backlog)},e.appendChild(c),c=document.createElement("button"),c.innerHTML="Pause",c.onclick=function(){d.pause()},e.appendChild(c),c=document.createElement("button"),c.innerHTML="Resume",c.onclick=function(){d.resume()},e.appendChild(c),e.appendChild(document.createElement("br"));for(var f=0;5>f;f++)c=document.createElement("button"),c.innerHTML="Active column",e.appendChild(c),a(c,f);for(var g=document.createElement("div"),h=0;5>h;h++)c=document.createElement("button"),c.innerHTML="Active new row",g.appendChild(c),b(c,h);e.appendChild(g),document.getElementsByTagName("body")[0].appendChild(e),d.start(document.getElementsByTagName("body")[0]),d.columns[0].activate(),d.columns[0].activeNextRow(),window.alert("Start !!??")};var DragAndDropUtil=function(){function a(a){a.container.draggable=!1,a.container.ondragstart=void 0}var b;return{makeDraggable:function(a){a.container.draggable=!0,a.container.ondragstart=function(c){c.dataTransfer.setData("text/plain",""),b=a}},makeDroppable:function(c,d){c.ondragenter=function(a){return a.preventDefault(),!0},c.ondragover=function(){return!1},c.ondrop=function(c){return c.stopPropagation(),void 0!==d&&d(b)===!0&&a(b),!1}}}}(),ViewUtil=function(){return{buildContainer:function(a){var b=document.createElement("div");return b.className=a,b}}}(),BacklogView=function(){"use strict";function a(a){this.controller=a,this.container=ViewUtil.buildContainer("backlog")}return a.prototype.draw=function(a){a.appendChild(this.container)},a}(),CardView=function(){"use strict";function a(a){this.controller=a,this.container=ViewUtil.buildContainer("card"),this.container.innerHTML="bug",DragAndDropUtil.makeDraggable(this)}return a.prototype.draw=function(a){a.appendChild(this.container)},a}(),ColumnView=function(){"use strict";function a(a){this.controller=a,this.container=ViewUtil.buildContainer("column inactive"),DragAndDropUtil.makeDroppable(this.container,function(b){return a.addCard(b.controller)})}return a.prototype.draw=function(a){a.appendChild(this.container)},a.prototype.activate=function(){this.container.className="column active"},a}(),GameView=function(){"use strict";function a(a){this.controller=a,this.container=ViewUtil.buildContainer("game")}return a.prototype.draw=function(a){a.appendChild(this.container)},a}(),HeaderColumnView=function(){"use strict";function a(a){this.controller=a,this.container=ViewUtil.buildContainer("headerColumn")}return a.prototype.draw=function(a){a.appendChild(this.container)},a}(),RowView=function(){"use strict";function a(a){this.controller=a,this.container=ViewUtil.buildContainer("row inactive")}return a.prototype.draw=function(a){a.appendChild(this.container)},a.prototype.activate=function(){this.container.className="row active"},a}();